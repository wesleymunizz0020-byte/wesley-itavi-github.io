<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Itavig - Gerenciador de Clientes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .status-red {
            background-color: #fee2e2;
            color: #ef4444;
        }
        .status-blue {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        .status-gray {
            background-color: #e5e7eb;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Itavig</h1>
        <input type="text" id="searchInput" placeholder="Pesquisar por nome do cliente..."
               class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4 w-full">
        <form id="clientForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <input type="text" id="clientName" placeholder="Nome do Cliente" required
                   class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <input type="date" id="paymentDate" required
                   class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <input type="number" id="paymentValue" placeholder="Valor (R$)" required
                   class="p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button type="submit" class="bg-blue-600 text-white p-3 rounded-md font-medium hover:bg-blue-700 transition-colors col-span-1 md:col-span-2">
                Adicionar Cliente
            </button>
        </form>

        <div id="clientsList">
            <!-- Lista de clientes será renderizada aqui -->
        </div>
    </div>

    <script>
        // Função para formatar a data como dd/mm/aaaa
        const formatDate = (dateString) => {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        };

        // Função para obter a diferença de dias entre duas datas
        const getDayDifference = (date1, date2) => {
            const diffTime = Math.abs(date2.getTime() - date1.getTime());
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        };

        // Função para renderizar a lista de clientes na página
        const renderClients = (clientsToRender) => {
            const clientsList = document.getElementById('clientsList');
            clientsList.innerHTML = ''; // Limpa a lista antes de renderizar

            let clients = clientsToRender || JSON.parse(localStorage.getItem('clients')) || [];
            
            if (clients.length === 0) {
                clientsList.innerHTML = `<p class="text-center text-gray-500">Nenhum cliente cadastrado.</p>`;
                return;
            }

            clients.forEach(client => {
                const now = new Date();
                const paymentDate = new Date(client.paymentDate);
                const daysAfterPayment = getDayDifference(now, paymentDate);
                let statusClass = '';
                let statusText = '';

                // Verifica o status do pagamento
                if (client.isPaid) {
                    if (daysAfterPayment > 5) {
                        statusClass = 'status-gray';
                        statusText = 'Regular (Pago)';
                    } else {
                        statusClass = 'status-blue';
                        statusText = 'Pago';
                    }
                } else if (now > paymentDate) {
                    statusClass = 'status-red';
                    statusText = 'Em Atraso';
                } else {
                    statusClass = 'status-blue'; // Considera azul se a data de pagamento ainda não chegou
                    statusText = 'A Pagar';
                }

                const clientCard = document.createElement('div');
                clientCard.classList.add('p-4', 'rounded-lg', 'shadow-sm', 'mb-4', 'flex', 'flex-col', 'md:flex-row', 'items-center', 'justify-between', statusClass);
                
                clientCard.innerHTML = `
                    <div class="flex-grow mb-2 md:mb-0">
                        <p class="text-lg font-bold">${client.name}</p>
                        <p class="text-sm">Data de Vencimento: ${formatDate(client.paymentDate)}</p>
                        <p class="text-sm">Valor: R$ ${parseFloat(client.value).toFixed(2).replace('.', ',')}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-sm font-semibold">${statusText}</span>
                        <button class="toggle-paid-btn bg-white text-gray-700 p-2 rounded-full shadow-md hover:bg-gray-100 transition-colors" data-id="${client.id}">
                            ${client.isPaid ? 'Marcar como Não Pago' : 'Marcar como Pago'}
                        </button>
                        <button class="delete-btn bg-white text-gray-700 p-2 rounded-full shadow-md hover:bg-gray-100 transition-colors" data-id="${client.id}">
                            Deletar
                        </button>
                    </div>
                `;
                clientsList.appendChild(clientCard);
            });

            // Adiciona listeners para os botões após a renderização
            document.querySelectorAll('.toggle-paid-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const id = event.target.dataset.id;
                    togglePaidStatus(id);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const id = event.target.dataset.id;
                    deleteClient(id);
                });
            });
        };

        // Função para alternar o status de pagamento
        const togglePaidStatus = (id) => {
            let clients = JSON.parse(localStorage.getItem('clients')) || [];
            clients = clients.map(client => {
                if (client.id === id) {
                    return { ...client, isPaid: !client.isPaid };
                }
                return client;
            });
            localStorage.setItem('clients', JSON.stringify(clients));
            renderClients();
        };

        // Função para deletar um cliente
        const deleteClient = (id) => {
            let clients = JSON.parse(localStorage.getItem('clients')) || [];
            clients = clients.filter(client => client.id !== id);
            localStorage.setItem('clients', JSON.stringify(clients));
            renderClients();
        };

        // Adiciona um novo cliente ao formulário
        document.getElementById('clientForm').addEventListener('submit', (event) => {
            event.preventDefault();
            const clientName = document.getElementById('clientName').value;
            const paymentDate = document.getElementById('paymentDate').value;
            const paymentValue = document.getElementById('paymentValue').value;

            const newClient = {
                id: Date.now().toString(), // ID único
                name: clientName,
                paymentDate: paymentDate,
                value: paymentValue,
                isPaid: false
            };

            let clients = JSON.parse(localStorage.getItem('clients')) || [];
            clients.push(newClient);
            localStorage.setItem('clients', JSON.stringify(clients));

            document.getElementById('clientForm').reset();
            renderClients();
        });

        // Event listener para a pesquisa de clientes
        document.getElementById('searchInput').addEventListener('keyup', (event) => {
            const searchTerm = event.target.value.toLowerCase();
            const allClients = JSON.parse(localStorage.getItem('clients')) || [];
            
            const filteredClients = allClients.filter(client => 
                client.name.toLowerCase().includes(searchTerm)
            );
            
            renderClients(filteredClients);
        });

        // Renderiza os clientes na página quando o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', renderClients);
    </script>
</body>
</html>
